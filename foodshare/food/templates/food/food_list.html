{% extends 'food/base.html' %}
{% load static %}
{% block content %}
	<div class="content_container">
			<h2>Food items available</h2>
			<form class="controls" action="{% url 'food_list' %}">
				{% csrf_token %}
    			<h4>Restrictions</h4>
    			<div class="checkbox">
      				<input type="checkbox" value="vegan" name="restrictions" {% if restrictions.vegan %} checked {% endif%} />
      				<label>Vegan</label>
      				<input type="checkbox" value="vegetarian" name="restrictions" {% if restrictions.vegetarian %} checked {% endif%} />
      				<label>Vegetarian</label>
      				<input type="checkbox" value="gluten_free" name="restrictions" {% if restrictions.gluten_free %} checked {% endif%} />
      				<label>Gluten-Free</label>
    			</div>
  				<button type="submit" formmethod="POST">Filter</button>
			</form>
			<form action="{% url 'food_list' %}">
				<button type="submit">Reset Filters</button>
			</form>
			<div class="food_item reg_left" style="height: 75vh; overflow-y: scroll;">
			<ul>
				{% for food in foods%}
				<li id="{{food.pk}}">
					<a href="{% url 'food_detail' pk=food.pk %}" id="list">{{food.title}}</a>
					<ul>
						<li>vegan: {{food.vegan}}</li>
						<li>veg: {{food.vegetarian}}</li>
						<li>gf: {{food.gluten_free}}</li>
						<li>{{food.location}}</li>
						<li>
							{{food.lat}}
						</li>
						<li>{{food.lng}}</li>
						<li>
							Availabile: {{food.available}}
						</li>
					</ul>
				</li>
				{% endfor %}
			</ul>
		</div>
		<div class="map_container reg_right" style="">
			<div id="map" style="width: 75vh; height: 75vh; position: absolute;"></div>
		</div>


<!-- 	<div class="food search">
	<div>
      <input id="address" type="textbox" value="">
      <input type="button" value="search" onclick="codeAddress()">
    </div>
	</div> -->
</div>
	<script>
      // var infoWindow, geocoder, map, marker1;
      function initMap() {
      		var boston = {lat: 42.360, lng: -71.058};
        	var map = new google.maps.Map(document.getElementById('map'), {
          		center: boston,
          		zoom: 11,
          // 		mapTypeControlOptions: {
          //   		mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain',
          //           'styled_map']
          // }
       		 });
        	var infoWindow = new google.maps.InfoWindow();
        	{% for food in foods %}
        		var position = new google.maps.LatLng(parseFloat('{{food.lat}}'), parseFloat('{{food.lng}}'));

        		var marker = new google.maps.Marker({
        			position: position,
        			map: map,
        			title: '{{food.title}}'
        		})

        		google.maps.event.addListener(marker,'click', function(){
  						infoWindow.setContent(
  							// '<h3>'+ '{{food.title}}'+'</h3>'
  							"<h5><a href=\"{% url 'food_detail' pk=food.pk %}\">{{food.title}}</a></h5>"
  							);
  						infoWindow.open(map,marker);

  						document.getElementById("{{food.pk}}").classList.add('hover');
  					
      //   		google.maps.event.addListener(marker, 'mouseover', function(){
      //   				infoWindow.open(map,marker);
      //   				
        		});
        	{% endfor %}
  			
  			// function setMarkers(dict){
  			// 	for (var i = 0; i < Object.keys(dict).length; i++){
  			// 		var marker1 = new google.maps.Marker({
  			// 			position: {lat: dict[i].lat, lng: dict[i].lng},
  			// 			map: map,
  			// 			title: dict[i].title
  			// 		});
  					
  			// 		google.maps.event.addListener(marker1, 'click', function(){
  			// 			infoWindow.setContent('<h3>'+ this.title+'</h3>');
  			// 			infoWindow.open(map,this);
  			// 		});
  			// 		marker1.setMap(map);
  			// 		console.log(dict[i]);
  			// 	}
  			// }

        // Create a new StyledMapType object, passing it an array of styles,
        // and the name to be displayed on the map type control.
        // var styledMapType = new google.maps.StyledMapType(
        //     [
        //       {elementType: 'geometry', stylers: [{color: '#ebe3cd'}]},
        //       {elementType: 'labels.text.fill', stylers: [{color: '#523735'}]},
        //       {elementType: 'labels.text.stroke', stylers: [{color: '#f5f1e6'}]},
        //       {
        //         featureType: 'administrative',
        //         elementType: 'geometry.stroke',
        //         stylers: [{color: '#c9b2a6'}]
        //       },
        //       {
        //         featureType: 'administrative.land_parcel',
        //         elementType: 'geometry.stroke',
        //         stylers: [{color: '#dcd2be'}]
        //       },
        //       {
        //         featureType: 'administrative.land_parcel',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#ae9e90'}]
        //       },
        //       {
        //         featureType: 'landscape.natural',
        //         elementType: 'geometry',
        //         stylers: [{color: '#dfd2ae'}]
        //       },
        //       {
        //         featureType: 'poi',
        //         elementType: 'geometry',
        //         stylers: [{color: '#dfd2ae'}]
        //       },
        //       {
        //         featureType: 'poi',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#93817c'}]
        //       },
        //       {
        //         featureType: 'poi.park',
        //         elementType: 'geometry.fill',
        //         stylers: [{color: '#a5b076'}]
        //       },
        //       {
        //         featureType: 'poi.park',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#447530'}]
        //       },
        //       {
        //         featureType: 'road',
        //         elementType: 'geometry',
        //         stylers: [{color: '#f5f1e6'}]
        //       },
        //       {
        //         featureType: 'road.arterial',
        //         elementType: 'geometry',
        //         stylers: [{color: '#fdfcf8'}]
        //       },
        //       {
        //         featureType: 'road.highway',
        //         elementType: 'geometry',
        //         stylers: [{color: '#f8c967'}]
        //       },
        //       {
        //         featureType: 'road.highway',
        //         elementType: 'geometry.stroke',
        //         stylers: [{color: '#e9bc62'}]
        //       },
        //       {
        //         featureType: 'road.highway.controlled_access',
        //         elementType: 'geometry',
        //         stylers: [{color: '#e98d58'}]
        //       },
        //       {
        //         featureType: 'road.highway.controlled_access',
        //         elementType: 'geometry.stroke',
        //         stylers: [{color: '#db8555'}]
        //       },
        //       {
        //         featureType: 'road.local',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#806b63'}]
        //       },
        //       {
        //         featureType: 'transit.line',
        //         elementType: 'geometry',
        //         stylers: [{color: '#dfd2ae'}]
        //       },
        //       {
        //         featureType: 'transit.line',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#8f7d77'}]
        //       },
        //       {
        //         featureType: 'transit.line',
        //         elementType: 'labels.text.stroke',
        //         stylers: [{color: '#ebe3cd'}]
        //       },
        //       {
        //         featureType: 'transit.station',
        //         elementType: 'geometry',
        //         stylers: [{color: '#dfd2ae'}]
        //       },
        //       {
        //         featureType: 'water',
        //         elementType: 'geometry.fill',
        //         stylers: [{color: '#b9d3c2'}]
        //       },
        //       {
        //         featureType: 'water',
        //         elementType: 'labels.text.fill',
        //         stylers: [{color: '#92998d'}]
        //       }
        //     ],
        //     {name: 'Styled Map'});

        // Create a map object, and include the MapTypeId to add
        // to the map type control.
        
        // geocoder = new google.maps.Geocoder();
       //  {% for food in foods %}
       // //  	geocoder.geocode('{{ food.location }}', function(results, status){
       // //  		if (status == google.maps.GeocoderStatus.OK) 
    			// // {
      	// 			var marker = new google.maps.Marker(
      	// 			{
       //   		 		map: map,
       //    				position: {lat: {{food.lat}}, lng: {{food.lng}}}
       //    				title: '{{food.title}}'
      	// 			});
       //  		// });
       //  {% endfor %}
        // infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
      //   if (navigator.geolocation) {
      //     navigator.geolocation.getCurrentPosition(function(position) {
      //       var pos = {
      //         lat: position.coords.latitude,
      //         lng: position.coords.longitude
      //       };

      //       var marker = new google.maps.Marker({position: pos, map: map});

      //       infoWindow.setPosition(pos);
      //       infoWindow.setContent('Location found.');
      //       infoWindow.open(map);
      //       map.setCenter(pos);
      //     }, function() {
      //       handleLocationError(true, infoWindow, map.getCenter());
      //     });
      //   } else {
      //     // Browser doesn't support Geolocation
      //     handleLocationError(false, infoWindow, map.getCenter());
      //   }
      // }

      // function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      //   infoWindow.setPosition(pos);
      //   infoWindow.setContent(browserHasGeolocation ?
      //                         'Error: The Geolocation service failed.' :
      //                         'Error: Your browser doesn\'t support geolocation.');
      //   infoWindow.open(map);

      //   //Associate the styled map with the MapTypeId and set it to display.
      //   map.mapTypes.set('styled_map', styledMapType);
      //   map.setMapTypeId('styled_map');

      // }

    // function codeAddress() {
    //     var address = document.getElementById('address').value;
    //     geocoder.geocode( { 'address': address}, function(results, status) {
    //       if (status == 'OK') {
    //         map.setCenter(results[0].geometry.location);
    //         var marker2 = new google.maps.Marker({
    //             map: map,
    //             position: results[0].geometry.location
    //         });
    //         if(marker2 != marker1 && marker1 != null) {
    //           marker1.setMap(null);

    //         }
    //         marker1 = marker2;
    //       } else {
    //         alert('Geocode was not successful for the following reason: ' + status);
    //       }
    //     });

      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdMG1pZuYC62w7geoDmMr0mELCBmoFtvY&language=en&callback=initMap">
    </script>
{% endblock %}